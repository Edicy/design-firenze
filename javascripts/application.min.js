var MMCQ,PriorityQueue;PriorityQueue=function(){function t(t){this.comparator=t,this.contents=[],this.sorted=!1}return t.prototype.sort=function(){return this.contents.sort(this.comparator),this.sotred=!0},t.prototype.push=function(t){return this.contents.push(t),this.sorted=!1},t.prototype.peek=function(t){return null==t&&(t=this.contents.length-1),this.sorted||this.sort(),this.contents[t]},t.prototype.pop=function(){return this.sorted||this.sort(),this.contents.pop()},t.prototype.size=function(){return this.contents.length},t.prototype.map=function(t){return this.contents.map(t)},t}(),MMCQ=function(){function t(){this.maxIterations=1e3,this.fractByPopulations=.75}var o,e,n,r,i,s;return t.sigbits=5,t.rshift=8-t.sigbits,r=function(o,e,n){return(o<<2*t.sigbits)+(e<<t.sigbits)+n},o=function(){function o(t,o,e,n,r,i,s){this.r1=t,this.r2=o,this.g1=e,this.g2=n,this.b1=r,this.b2=i,this.histo=s}return o.prototype.volume=function(t){return this._volume&&!t||(this._volume=(this.r2-this.r1+1)*(this.g2-this.g1+1)*(this.b2-this.b1+1)),this._volume},o.prototype.count=function(t){var o,e,n,i,s,a,c,u,h,l,g;if(!this._count_set||t){for(i=0,s=a=this.r1,h=this.r2;a<=h;s=a+=1)for(e=c=this.g1,l=this.g2;c<=l;e=c+=1)for(o=u=this.b1,g=this.b2;u<=g;o=u+=1)n=r(s,e,o),i+=this.histo[n]||0;this._count_set=!0,this._count=i}return this._count},o.prototype.copy=function(){return new o(this.r1,this.r2,this.g1,this.g2,this.b1,this.b2,this.histo)},o.prototype.average=function(o){var e,n,i,s,a,c,u,h,l,g,f,d,p,b,m,v;if(!this._average||o){for(u=1<<8-t.sigbits,g=0,l=0,s=0,n=0,h=f=this.r1,b=this.r2;f<=b;h=f+=1)for(i=d=this.g1,m=this.g2;d<=m;i=d+=1)for(e=p=this.b1,v=this.b2;p<=v;e=p+=1)c=r(h,i,e),g+=a=this.histo[c]||0,l+=a*(h+.5)*u,s+=a*(i+.5)*u,n+=a*(e+.5)*u;this._average=g?[~~(l/g),~~(s/g),~~(n/g)]:[~~(u*(this.r1+this.r2+1)/2),~~(u*(this.g1+this.g2+1)/2),~~(u*(this.b1+this.b2+1)/2)]}return this._average},o.prototype.contains=function(o){var e,n,r;return r=o[0]>>t.rshift,n=o[1]>>t.rshift,e=o[2]>>t.rshift,this.r1<=r&&r<=this.r2&&this.g1<=n&&n<=this.g2&&this.b1<=e&&e<=this.b2},o}(),e=function(){function t(){this.cboxes=new PriorityQueue(function(t,o){var e,n;return e=t.count()*t.volume(),n=o.count()*o.volume(),e>n?1:e<n?-1:0})}return t.prototype.push=function(t){return this.cboxes.push({cbox:t,color:t.average()})},t.prototype.palette=function(){return this.cboxes.map(function(t){return t.color})},t.prototype.size=function(){return this.cboxes.size()},t.prototype.map=function(t){var o,e,n;for(o=e=0,n=this.cboxes.size();e<n;o=e+=1)return this.cboxes.peek(o).cbox.contains(t)?this.cboxes.peek(o).color:this.nearest(t)},t.prototype.cboxes=function(){return this.cboxes},t.prototype.nearest=function(t){var o,e,n,r,i,s,a;for(i=function(t){return t*t},n=1e9,e=s=0,a=this.cboxes.size();s<a;e=s+=1)(o=Math.sqrt(i(t[0]-this.cboxes.peek(e).color[0])+i(t[1]-this.cboxes.peek(e).color[1])+i(t[2]-this.cboxes.peek(e).color[2])))<n&&(n=o,r=this.cboxes.peek(e).color);return r},t}(),i=function(o){var e,n,i,s,a,c,u,h,l;for(s=1<<3*t.sigbits,i=new Array(s),h=0,l=o.length;h<l;h++)u=(c=o[h])[0]>>t.rshift,n=c[1]>>t.rshift,e=c[2]>>t.rshift,i[a=r(u,n,e)]=(i[a]||0)+1;return i},n=function(e,n){var r,i,s,a,c,u,h,l,g,f,d,p;for(f=1e6,g=0,u=1e6,c=0,s=1e6,i=0,d=0,p=e.length;d<p;d++)l=(h=e[d])[0]>>t.rshift,a=h[1]>>t.rshift,r=h[2]>>t.rshift,l<f?f=l:l>g&&(g=l),a<u?u=a:a>c&&(c=a),r<s?s=r:r>i&&(i=r);return new o(f,g,u,c,s,i,n)},s=function(t,o){var e,n,i,s,a,c,u,h,l,g,f,d,p,b,m,v,w,C,y,k,j,x,P,M,z,_,H,L,O,D;if(o.count()){if(1===o.count())return[o.copy()];if(g=o.r2-o.r1+1,a=o.g2-o.g1+1,n=o.b2-o.b1+1,u=Math.max(g,a,n),d=0,h=[],c=[],u===g)for(l=p=o.r1,x=o.r2;p<=x;l=p+=1){for(f=0,s=b=o.g1,H=o.g2;b<=H;s=b+=1)for(e=m=o.b1,L=o.b2;m<=L;e=m+=1)f+=t[r(l,s,e)]||0;d+=f,h[l]=d}else if(u===a)for(s=v=o.g1,O=o.g2;v<=O;s=v+=1){for(f=0,l=w=o.r1,D=o.r2;w<=D;l=w+=1)for(e=C=o.b1,P=o.b2;C<=P;e=C+=1)f+=t[r(l,s,e)]||0;d+=f,h[s]=d}else for(e=y=o.b1,M=o.b2;y<=M;e=y+=1){for(f=0,l=k=o.r1,z=o.r2;k<=z;l=k+=1)for(s=j=o.g1,_=o.g2;j<=_;s=j+=1)f+=t[r(l,s,e)]||0;d+=f,h[e]=d}return h.forEach(function(t,o){return c[o]=d-t}),i=function(t){var e,n,r,i,s,a,u,l,g,f,p;for(a=t+"2",u=f=o[s=t+"1"],p=o[a];f<=p;u=f+=1)if(h[u]>d/2){for(e=o.copy(),n=o.copy(),i=(l=u-o[s])<=(g=o[a]-u)?Math.min(o[a]-1,~~(u+g/2)):Math.max(o[s],~~(u-1-l/2));!h[i];)i++;for(r=c[i];!r&&h[i-1];)r=c[--i];return e[a]=i,n[s]=e[a]+1,[e,n]}},u===g?i("r"):u===a?i("g"):u===n?i("b"):void 0}},t.prototype.quantize=function(t,o){var r,a,c,u,h,l,g=this;if(!t.length||o<2||o>256)return console.log("invalid arguments"),!1;for(c=i(t),r=n(t,c),(h=new PriorityQueue(function(t,o){var e,n;return e=t.count(),n=o.count(),e>n?1:e<n?-1:0})).push(r),(u=function(t,o){var e,n,i,a,u;for(a=1,u=0;u<g.maxIterations;)if((r=t.pop()).count()){if(i=s(c,r),e=i[0],n=i[1],!e)return void console.log("cbox1 not defined; shouldn't happen");if(t.push(e),n&&(t.push(n),a++),a>=o)return;if(u++>g.maxIterations)return void console.log("infinite loop; perhaps too few pixels")}else t.push(r),u++})(h,this.fractByPopulations*o),l=new PriorityQueue(function(t,o){var e,n;return e=t.count()*t.volume(),n=o.count()*o.volume(),e>n?1:e<n?-1:0});h.size();)l.push(h.pop());for(u(l,o-l.size()),a=new e;l.size();)a.push(l.pop());return a},t}.call(this),function(){window.ColorExtract=function(){function t(){}return t.getColorMap=function(t,o,e,n,r,i){var s,a,c,u,h,l,g,f,d,p;for(null==i&&(i=8),c=t.getContext("2d").getImageData(o,e,n,r).data,u=[],l=g=e,d=e+r;g<d;l=g+=1)for(a=l*n*4,h=f=o,p=o+n;f<p;h=f+=1)s=a+4*h,u.push([c[s],c[s+1],c[s+2]]);return(new MMCQ).quantize(u,i)},t.colorDist=function(t,o){var e;return(e=function(t){return t*t})(t[0]-o[0])+e(t[1]-o[1])+e(t[2]-o[2])},t.extract=function(o,e,n){var r,i,s,a,c,u,h,l,g,f,d,p,b;for(e.width=25,e.height=25,e.getContext("2d").drawImage(o,0,0,e.width,e.height),(i=t.getColorMap(e,0,0,e.width,e.height,4).cboxes.map(function(t){return{count:t.cbox.count(),rgb:t.color}})).sort(function(t,o){return o.count-t.count}),r=i[0].rgb,(h=t.getColorMap(e,0,0,o.width,o.height,10).cboxes.map(function(t){return{count:t.cbox.count(),rgb:t.color}})).sort(function(t,o){return o.count-t.count}),l=0,f=0,p=h.length;f<p;f++)s=h[f],(a=t.colorDist(r,s.rgb))>l&&(l=a,c=s.rgb);for(l=0,d=0,b=h.length;d<b;d++)s=h[d],(a=t.colorDist(r,s.rgb))>l&&s.rgb!==c&&(l=a,u=s.rgb);return g=function(t){return"rgb("+t[0]+", "+t[1]+", "+t[2]+")"},n({bgColor:g(r),fgColor:g(c),fgColor2:g(u)})},t}()}.call(this),function(t){var o=t("html").hasClass("editmode"),e=t("body").hasClass("bgpicker-fallback"),n=function(t,o,e){var n;return function(){var r=this,i=arguments,s=e&&!n;clearTimeout(n),n=setTimeout(function(){n=null,e||t.apply(r,i)},o),s&&t.apply(r,i)}},r=function(){t("html").click(function(){t(".js-btn").hasClass("open")&&t(".js-btn").removeClass("open"),t(".js-popover").hasClass("expanded")&&t(".js-popover").removeClass("expanded"),t(".js-search-inner").hasClass("active")&&t(".js-search-inner").removeClass("active")}),t(".js-menu-btn").click(function(o){o.stopPropagation(),t(this).toggleClass("open"),t(".js-menu-main").toggleClass("expanded"),t(".js-search-close-btn").hasClass("open")&&t(".js-search-close-btn").trigger("click")}),t(".js-menu-lang-btn").click(function(o){o.stopPropagation(),t(".js-menu-lang-btn").toggleClass("open"),t(".js-menu-lang").toggleClass("expanded")}),t(".js-tags-btn").click(function(o){o.stopPropagation(),t(this).toggleClass("open"),t(".js-menu-tags").toggleClass("expanded")}),t(".js-search").click(function(){t(".js-search-close-btn").trigger("click")}),t(".js-search-open-btn").click(function(o){o.stopPropagation(),t(".js-menu-btn").hasClass("open")&&t(".js-menu-btn").trigger("click"),t("html").addClass("search-open"),t(this).addClass("open"),t(".js-search-close-btn").addClass("open"),t(".js-search").addClass("active"),t(".js-search-input").val("").focus()}),t(".js-search-close-btn").click(function(o){o.stopPropagation(),t("html").removeClass("search-open"),t(".js-search-open-btn, .js-search-close-btn").removeClass("open"),t(".js-search").removeClass("active"),t(".js-voog-search-modal").removeClass("search-results-active")}),t(".js-search-form, .js-voog-search-modal").click(function(t){t.stopPropagation()})},i=function(){var o=t(window).width();windowHeight=t(window).height(),searchModal=t(".js-voog-search-modal"),searchModalHeight=o>=1400?windowHeight-190:windowHeight-171,searchModal.css({"max-height":searchModalHeight})},s=function(){t(".js-search-form").on("submit",function(){i()})},a=function(){t(document).ready(function(){t(".comment-form").hasClass("form_with_errors")?t("html, body").scrollTop(t(".comment-form").offset().top):t("form").find(".form_error, .form_notice").length>0&&t("html, body").scrollTop(t(".form_error, .form_notice").closest("form").offset().top)})},c=function(){t(".js-container");var o,e,n,r=t(".js-topbar"),i=t(".js-header"),s=t(".js-menu-tags"),a=t(r).outerHeight(),c=t(i).outerHeight()+150;t(s).outerHeight();t(r).css({top:-a}),t(window).on("scroll",function(){t(window).scrollTop()<=0&&t(r).css({top:-a}),o?(e=t(window).scrollTop(),(n=e-o)<-5&&o>c?(t("body").hasClass("edy-checkout-button-visible")?headerOffset=t(".edy-ecommerce-shopping-cart-button").outerHeight():headerOffset=0,t(r).css({top:headerOffset})):(n<0&&o<c||n>0&&o>c)&&(s.hasClass("expanded")&&(t(s).removeClass("expanded"),t(".js-tags-btn").removeClass("open")),t(r).css({top:-a})),o=0):o=t(window).scrollTop()})};handleLayoutPositioning=function(){var e=t(".js-container");containerWrap=e.find(".js-wrap"),footer=t(".js-footer"),footerInner=t(".js-footer-inner"),footerGradientHeight=85,editmodePanelHeight=40,windowHeight=windowHeight=o?t(window).height()-editmodePanelHeight:t(window).height(),brakePoint=2*footer.innerHeight()-footerGradientHeight+containerWrap.innerHeight(),brakePoint>windowHeight?e.addClass("container-long"):e.removeClass("container-long")};var u=function(){if(function(){for(var t=["WebKit","Moz","O","Ms",""],o=0;o<t.length;o++)if(t[o]+"MutationObserver"in window)return window[t[o]+"MutationObserver"];return!1}()){var t=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver,o=document.querySelector(".js-wrap"),e={childList:!0,subtree:!0},n=document.querySelector(".js-footer-inner"),e={attributes:!0,childList:!0,subtree:!0},r=new t(function(t){t.forEach(function(t){handleLayoutPositioning()})});r.observe(o,e),r.observe(n,e)}else setInterval(function(){handleLayoutPositioning()},1e3)},h=function(){!1===o&&t.each(t(".content-formatted"),function(){t(this).hasClass("js-custom-content-formatted")||t(this).find("table").wrap('<div class="table-container overthrow"></div>')})},l=function(){if(color=t(".js-body-background-color").css("background-color"),"rgba(0, 0, 0, 0)"===color||"transparent"===color)t(document).ready(function(){t(".js-background-type").addClass("dark-background").removeClass("light-background"),t(".js-background-type").addClass("light-background").removeClass("dark-background")});else if(color){var o=function(t){if(t&&"string"==typeof t){var o=t.match(/(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,?\s*([\d\.]+)?\s*)/);return o?{r:+o[2],g:+o[3],b:+o[4],a:o[5]?+o[5]:1}:void 0}}(color),e=o.r+o.g+o.b;e+o.a>0&&e/3>128?t(".js-background-type").addClass("light-background").removeClass("dark-background"):t(".js-background-type").addClass("dark-background").removeClass("light-background")}},g=function(t,o){for(var e,n=0,r=t.length;n<r;n++){if(t[n].width<o)return e||t[n];e=t[n]}return t[t.length-1]},f=function(t,o){for(var e=t.length;e--;)if(o.indexOf(t[e].url.trim())>-1)return!0;return!1},d=function(o,e){e>.6?t(o).find(".js-background-type").addClass("light-background").removeClass("dark-background"):t(o).find(".js-background-type").addClass("dark-background").removeClass("light-background")},p=function(o,e){if(o&&e){"string"==typeof o&&(o=o.replace(/rgba?\(/,"").replace(/\)/,"").split(","),t.each(o,function(t,e){o[t]=+e})),"string"==typeof e&&(e=e.replace(/rgba?\(/,"").replace(/\)/,"").split(","),t.each(e,function(t,o){e[t]=+o})),"object"==typeof o&&o.hasOwnProperty("length")&&3==o.length&&o.push(1),"object"==typeof e&&e.hasOwnProperty("length")&&3==e.length&&e.push(1);var n=[0,0,0,0];return n[3]=1-(1-e[3])*(1-o[3]),0===n[3]&&(n[3]=1e-6),n[0]=Math.min(e[0]*e[3]/n[3]+o[0]*o[3]*(1-e[3])/n[3],255),n[1]=Math.min(e[1]*e[3]/n[3]+o[1]*o[3]*(1-e[3])/n[3],255),n[2]=Math.min(e[2]*e[3]/n[3]+o[2]*o[3]*(1-e[3])/n[3],255),t.map(n,function(t){return Math.floor(t)})}},b=function(t,o){return p(t||[255,255,255,1],o||[255,255,255,1])},m=function(t,o){var e=b(t,o);return Math.round((.2126*+e[0]+.7152*+e[1]+.0722*+e[2])/2.55)/100},v=function(){document.addEventListener("edicy:customstyles:change",function(t){var o=["--header-mainmenu-font-size","--header-mainmenu-line-height","--header-mainmenu-line-height","--font-two"];Object.keys(t.detail.changes).filter(function(t){return o.indexOf(t)>-1}).length>0&&c()})},w=function(){t(window).resize(function(){t(window).resize(n(c,500)),t(window).resize(n(handleLayoutPositioning,500)),t(window).resize(n(i,500))})};window.site=t.extend(window.site||{},{toggleFlags:function(){t(".js-option-toggle-flags").on("click",function(o){if(o.stopPropagation(),t(this).hasClass("js-flag-disable-btn"))e=!1;else var e=!0;t(this).toggleClass("js-flag-disable-btn"),t(".js-header").toggleClass("flags-enabled flags-disabled"),siteData.set("flags_state",e)})},bgPickerPreview:function(o,e,n,r){var i=t(o).find(".js-background-image").css("background-image"),s=e.imageSizes?g(e.imageSizes,t(window).width()):null,a=e.image&&""!==e.image?"url("+s.url+")":"none",c=e.imageSizes&&""!==e.imageSizes?e.imageSizes:null,u=e.color&&""!==e.color?e.color:"rgba(0,0,0,0)",h=(e.colorData&&""!==e.colorData&&e.colorData.lightness,t("<img>")),l=t("<canvas>"),p=e.image&&""!==e.image?e.image:null;p?f(c,i)?(n.imageColor=n.imageColor?n.imageColor:r,n.combinedLightness=m(n.imageColor,u),d(o,n.combinedLightness)):(h.attr("src",p.replace(/.*\/(photos|voogstock)/g,"/photos")),h.on("load",function(){ColorExtract.extract(h[0],l[0],function(t){n.imageColor=t.bgColor?t.bgColor:"rgba(255,255,255,1)",n.combinedLightness=m(n.imageColor,u),d(o,n.combinedLightness)})})):(n.imageColor="rgba(255,255,255,1)",n.combinedLightness=m(n.imageColor,u),d(o,n.combinedLightness)),t(o).find(".js-background-image").css({"background-image":a}),t(o).find(".js-background-color").css({"background-color":u})},bgPickerCommit:function(o,e,n,r){var i=t.extend(!0,{},e);i.image=e.image||"",i.imageSizes=e.imageSizes||"",i.color=e.color||"",i.combinedLightness=n.combinedLightness,"articlePage"===r?Edicy.articles.currentArticle.setData(o,i):pageData.set(o,i)},bgPickerColorScheme:function(o){void 0!==o&&(o>.6?t(".header-wrapper").addClass("light").removeClass("dark"):t(".header-wrapper").addClass("dark").removeClass("light"))},initFrontPage:function(){},initCommonPage:function(){c(),v()},initBlogPage:function(){c(),v()},initPostPage:function(){c(),v()}}),e&&l(),r(),handleLayoutPositioning(),u(),s(),a(),w(),h()}(jQuery);
